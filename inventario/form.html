{% extends "base.html" %}
{% block title %}{{ 'Editar' if item else 'Nuevo' }} Producto - M√∫sica Vintage{% endblock %}
{% block content %}
<div class="row mb-4">
  <div class="col-md-8">
    <h2>{{ '‚úèÔ∏è Editar Producto' if item else '‚ûï Nuevo Producto' }}</h2>
  </div>
</div>

<div class="row">
  <div class="col-md-8">
    <form method="post" class="needs-validation">
      <div class="mb-3">
        <label for="artista_id" class="form-label fw-bold">Artista * (Selecciona el artista del producto)</label>
        <select class="form-select" id="artista_id" name="artista_id" required onchange="actualizarNombreArtista()">
          <option value="">-- Selecciona un artista --</option>
          {% for artista in artistas %}
          <option value="{{ artista._id }}" {% if item and item.artista_id == artista._id %}selected{% endif %}>
            {{ artista.nombre }} ({{ artista.pais }})
          </option>
          {% endfor %}
        </select>
        <small class="text-muted">El nombre se completar√° autom√°ticamente</small>
      </div>
      
      <div class="mb-3">
        <label for="nombre_artista" class="form-label fw-bold">Nombre Artista (Auto)</label>
        <input type="text" class="form-control" id="nombre_artista" name="nombre_artista" value="{{ item.nombre_artista if item else '' }}" readonly>
        <small class="text-muted">Se completa autom√°ticamente al seleccionar artista</small>
      </div>
      
      <div class="mb-3">
        <label for="album" class="form-label fw-bold">√Ålbum *</label>
        <input type="text" class="form-control" id="album" name="album" value="{{ item.album if item else '' }}" required>
        <small class="text-muted">Nombre del √°lbum</small>
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="a√±o" class="form-label fw-bold">A√±o *</label>
            <input type="number" class="form-control" id="a√±o" name="a√±o" value="{{ item.a√±o if item else '' }}" required min="1900" max="2100">
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="genero" class="form-label fw-bold">G√©nero</label>
            <input type="text" class="form-control" id="genero" name="genero" value="{{ item.genero if item else '' }}">
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            <label for="stock" class="form-label fw-bold">Stock *</label>
            <input type="number" class="form-control" id="stock" name="stock" value="{{ item.stock if item else 0 }}" required min="0">
            <small class="text-muted">Cantidad disponible</small>
          </div>
        </div>
        <div class="col-md-6">
          <div class="mb-3">
            <label for="precio_unitario" class="form-label fw-bold">Precio Unitario *</label>
            <input type="number" class="form-control" id="precio_unitario" name="precio_unitario" value="{{ item.precio_unitario if item else 0 }}" required min="0" step="0.01">
            <small class="text-muted">Precio en d√≥lares</small>
          </div>
        </div>
      </div>
      
      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-success btn-lg">üíæ Guardar</button>
        <a href="{{ url_for('inventario_list') }}" class="btn btn-secondary btn-lg">‚ùå Cancelar</a>
      </div>
    </form>
  </div>
</div>

<script>
function actualizarNombreArtista() {
  const select = document.getElementById('artista_id');
  const nombreInput = document.getElementById('nombre_artista');
  
  if (select.value) {
    const textoSeleccionado = select.options[select.selectedIndex].text;
    // Extrae el nombre sin el pa√≠s
    const nombre = textoSeleccionado.split('(')[0].trim();
    nombreInput.value = nombre;
  } else {
    nombreInput.value = '';
  }
}

// Al cargar la p√°gina, si hay un artista seleccionado, actualizar el nombre
document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('artista_id').value) {
    actualizarNombreArtista();
  }
});
</script>
{% endblock %}
